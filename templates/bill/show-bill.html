{% extends "base.html" %}

{% block main %}
Show-Bill Information
<h2>Order: #{{order.id}}</h2>

<h2>Customer Details</h2>
<table class="table table-bordered">
    <thead>
        <th>Name</th>
        <th>Phone</th>
        <th>Address</th>
    </thead>
    <tbody>
        <td>{{customer.name}}</td>
        <td>{{customer.phone}}</td>
        <td>{{customer.address}}</td>
    </tbody>
</table>

<h2>Order Details</h2>
<table class="table table-bordered">
    <thead>
        <th>Product</th>
        <th>Quantity</th>
        <th>Price</th>
        <th>Amount</th>
    </thead>
    <tbody>
        {% for prod in ordered_products %}
        <tr>
            <td>{{prod.name}}</td>
            <td>{{prod.quantity}}</td>
            <td>{{prod.price_per_quantity}}</td>
            <td>{{prod.quantity * prod.price_per_quantity}}</td>
        </tr>
        {% endfor %}
        <tr>
            <th colspan="3">Total</th>
            <th>â‚¹{{order.order_total}}</th>
        </tr>
    </tbody>
</table>

<h2>Payment Details</h2>
<div class="row">
    <div class="col">
        <div class="form-check">
            <input class="form-check-input" type="radio" name="payment_method" id="pay_by_online" value="online">
            <label class="form-check-label" for="pay_by_online">
            Pay By Online Methods
            </label>
        </div>
    </div>
    <div class="col">
        <div class="form-check">
            <input class="form-check-input" type="radio" name="payment_method" id="pay_by_cash" value="cash" checked>
            <label class="form-check-label" for="pay_by_cash">
            Pay By Cash
            </label>
        </div>
    </div>
</div>

<div class="row">
    <div class="col align-center">
        <button class="btn btn-success" onclick="updatePaymentMethod()">Proceed</button>
    </div>
</div>
{% endblock  %}

{% block script %}
<script>
function getPaymentMethod() {
    const paymentMethod = document.querySelector('input[name="payment_method"]:checked');
    return paymentMethod.value;
}

function updatePaymentMethod() {
    fetch("/update-payment-method", {
    method: "POST",
    headers: {
        "Content-Type": "application/json"
    },
    body: JSON.stringify({
        payment_method: getPaymentMethod()
    })
    })
    .then(response => {console.log(response);
        if(response.status === 200) {
            window.location.pathname='/create-bill';
          }
    })
    .then(data => {console.log(data);window.location.reload();})
    .catch(error => console.error('Error:', error));
}
</script>
{% endblock  %}